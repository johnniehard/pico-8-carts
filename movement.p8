pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
//hello

// sprite scale
s=8

function player(x, y)
    local p = {}
    // location
    p.l={x=x,y=y}
    // acceleration
    p.a={x=0,y=0}
    // velocity
    p.v={x=0,y=0}
    // max velocity
    p.mv=1
    // flip x
    p.fx=false
    // flip y
    p.fy=false
    // damping
    p.d=0

    p.push = function(_, x, y)
        // add force to acceleration
        _.a.x+=x
        _.a.y+=y
    end

    p.update = function(_)
        // add acceleration to velocity
        _.v.x+=_.a.x
        _.v.y+=_.a.y
        // cap velocity
        if(_.v.x > _.mv) then _.v.x=_.mv end
        if(_.v.y > _.mv) then _.v.y=_.mv end
        if(_.v.x < -_.mv) then _.v.x=-_.mv end
        if(_.v.y < -_.mv) then _.v.y=-_.mv end
        // sprite flip
        if(_.v.x>0) then _.fx=false elseif(_.v.x<0) then _.fx=true end
        if(_.v.y>0) then _.fy=false elseif(_.v.y<0) then _.fy=true end
        // add velocity to location
        _.l.x+=_.v.x
        _.l.y+=_.v.y
        // damping
        _.v.x*=_.d
        _.v.y*=_.d
        // clear acceleration
        _.a.x*=0
        _.a.y*=0
    end

    p.draw = function(_)
        spr(2,_.l.x, _.l.y,1,1,_.fx,_.fy)
    end

    return p
end

// Helper functions
// pixels to sprite unit
function pxs(px)
    return (px-px%8)/8
end
// sprite unit to pixels
function spx(s)
    px=s*8
    return px-px%8
end

p=player(spx(1), spx(1))

function _update()
 if(btn(0)) then p.push(p,-1, 0) end
 if(btn(1)) then p.push(p,1, 0) end
 if(btn(2)) then p.push(p,0, -1) end
 if(btn(3)) then p.push(p,0, 1) end
 p.update(p)
end

function _draw()
    cls()

    map(0,0,0,0,16,16)

    p.draw(p)

    print(pxs(p.l.x),0,0,15)

    
end

__gfx__
00000000999999990004400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999990044444004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700999999990044400004004444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000999999990044400044444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000999999990044440044444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700999999990044440004444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999990044040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999990044040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
